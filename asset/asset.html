<!DOCTYPE html>
<html>
	<head>
		<title>Assets</title>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- use Google font -->
		<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<script type="text/javascript" src="dataset.js"></script>
		<!-- Bootstrap -->
    <link href="/static/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">


    <!-- Styles -->
    <style>
    #chartdiv {
      width: 100%;
      height: 500px;
    }
		#chartdiv_semicircle {
      width: 100%;
      height: 500px;
    }
		th {
			text-align:center;
			vertical-align:middle;
		}
		td {
			text-align:right;
			vertical-align:middle;
		}
		.summary{
			font-weight:bold;
			color:blue;
		}

    </style>
		<link href="/static/lib/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>

    <!-- Resources -->
    <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/kelly.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	  <script src="colors.js"></script>
	  <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js"></script>
	  <script src=https://cdn.jsdelivr.net/npm/promise-polyfill@8.1/dist/polyfill.min.js></script>
	  <script src=https://cdn.jsdelivr.net/npm/whatwg-fetch@3.0/dist/fetch.umd.min.js></script>


	</head>
    <!-- HTML -->
  <body>
		<div id="body" class="container">
      <div class="row-fluid">
        <div class="row">
          <div class="span12">
						<h3>1. 또또맘 투자자산의 수익 그래프입니다.</h3>
						<br>
						<div id="chartdiv">
						</div>
						<br><br><br><br>
					</div>
					<div class="span12">
						<h3>2. <span id="today"></span> 일자의 또또맘 자산현황입니다.</h3>
						<br>
						<table class="table table-striped" style="width:100%;">
							<thead id="table_head" style="text-align:center;">
								<tr>
									<th>
										계좌
									</th>
									<th>
										원금
									</th>
									<th>
										현재 자산
									</th>
									<th>
										손익
									</th>
									<th>
										수익률
									</th>
								</tr>
							</thead>
							<tbody id="table_body" style="text-align:right;">
								<tr>
									<td>
										한국주식(삼성증)
									</td>
									<td>
										<span id="p1"></span>
									</td>
									<td>
										<span id="f1"></span>
									</td>
									<td>
										<span id="b1"></span>
									</td>
									<td>
										<span id="r1"></span>
									</td>
								</tr>
								<tr>
									<td>
										KOSPI Index Fund
									</td>
									<td>
										<span id="p2"></span>
									</td>
									<td>
										<span id="f2"></span>
									</td>
									<td>
										<span id="b2"></span>
									</td>
									<td>
										<span id="r2"></span>
									</td>
								</tr>
								<tr>
									<td>
										미국주식(KB증, 메인)
									</td>
									<td>
										<span id="p3"></span>
									</td>
									<td>
										<span id="f3"></span>
									</td>
									<td>
										<span id="b3"></span>
									</td>
									<td>
										<span id="r3"></span>
									</td>
								</tr>
								<tr>
									<td>
										미국주식(KB증, 배당투자)
									</td>
									<td>
										<span id="p4"></span>
									</td>
									<td>
										<span id="f4"></span>
									</td>
									<td>
										<span id="b4"></span>
									</td>
									<td>
										<span id="r4"></span>
									</td>
								</tr>
								<tr>
									<td>
										미국주식(신한금투, 서브)
									</td>
									<td>
										<span id="p5"></span>
									</td>
									<td>
										<span id="f5"></span>
									</td>
									<td>
										<span id="b5"></span>
									</td>
									<td>
										<span id="r5"></span>
									</td>
								</tr>
								<tr>
									<td>
										AIM 자산관리
									</td>
									<td>
										<span id="p6"></span>
									</td>
									<td>
										<span id="f6"></span>
									</td>
									<td>
										<span id="b6"></span>
									</td>
									<td>
										<span id="r6"></span>
									</td>
								</tr>
								<tr>
									<td>
										금융자산 소계
									</td>
									<td>
										<span class="summary" id="pmnt"></span>
									</td>
									<td>
										<span class="summary" id="fv"></span>
									</td>
									<td>
										<span class="summary" id="profit"></span>
									</td>
									<td>
										<span class="summary" id="rate"></span>
									</td>
								</tr>
							</tbody>
						</table>
						<br><br><br><br>
					</div>
					<div class="span12">
						<h3>3. 또또맘 투자자산의 비중입니다.</h3>
						<br>
						<div id="chartdiv_semicircle">
						</div>
						<br>
					</div>
				</div>
			</div>
		</div>
		<script src="http://code.jquery.com/jquery.js"></script>
    <script src="/static/lib/bootstrap/js/bootstrap.min.js"></script>
		<!-- Chart code -->
    <script>
		am4core.ready(function() {

		// Themes begin
		am4core.useTheme(am4themes_kelly);
		am4core.useTheme(am4themes_animated);
		// Themes end

		// Create chart instance
		var chart = am4core.create("chartdiv", am4charts.XYChart);

		// Date format setting
		function getFormatDate(dateFormat){
			var year = dateFormat.getFullYear();
			var month = (1+dateFormat.getMonth());
				month = month >= 10 ? month : '0'+month;
			var day = dateFormat.getDate();
				day = day >= 10 ? day : '0'+day;
			return year+'-'+month+'-'+day;
		}
		// Create daily series and related axes
		var dateAxis1 = chart.xAxes.push(new am4charts.DateAxis());
		dateAxis1.renderer.grid.template.location = 0;
		dateAxis1.renderer.minGridDistance = 60;

		var valueAxis1 = chart.yAxes.push(new am4charts.ValueAxis());

		var series1 = chart.series.push(new am4charts.ColumnSeries());
		series1.dataFields.valueY = "value";
		series1.dataFields.dateX = "date";
		series1.data = generateDailyData();
		series1.xAxis = dateAxis1;
		series1.yAxis = valueAxis1;
		series1.tooltipText = "{dateX}손익: [bold]{valueY}[/]";

		// Create hourly series and related axes
		var dateAxis2 = chart.xAxes.push(new am4charts.DateAxis());
		dateAxis2.renderer.grid.template.location = 0;
		dateAxis2.renderer.minGridDistance = 40;
		dateAxis2.renderer.labels.template.disabled = true;
		dateAxis2.renderer.grid.template.disabled = true;
		dateAxis2.renderer.tooltip.disabled = true;

		var valueAxis2 = chart.yAxes.push(new am4charts.ValueAxis());
		valueAxis2.renderer.opposite = true;
		valueAxis2.renderer.grid.template.disabled = true;
		valueAxis2.renderer.labels.template.disabled = false;
		valueAxis2.renderer.tooltip.disabled = true;

		var series2 = chart.series.push(new am4charts.LineSeries());
		series2.dataFields.valueY = "value";
		series2.dataFields.dateX = "date";
		series2.data = generateHourlyData();
		series2.xAxis = dateAxis2;
		series2.yAxis = valueAxis2;
		series2.tensionX = 0.7;
		series2.strokeWidth = 2;
		series2.tooltipText = "{dateX.formatDate('yyyy-MM-dd')}수익률: [bold]{valueY}%[/]";

		// Add cursor
		chart.cursor = new am4charts.XYCursor();


		function generateDailyData() {
		    var firstDate = new Date('2020-07-30');
				var today = new Date();
				today.setHours(9,0,0,0);

				var dayPeriod = (today-firstDate)/1000/60/60/24+1;

        firstDate.setDate(firstDate.getDate());
		    var data = [];
				var resultArray = new Array;
					resultArray = [1];//dummydata


		    for(var i = 0; i < dayPeriod; i++) {
		      var newDate = new Date(firstDate);
		      newDate.setDate(newDate.getDate() + i);
					var dateFormat = getFormatDate(newDate);
					var result = dataset.find(dateIndex => dateIndex.date === dateFormat);

					//
					if(result && true){
						pmnt=Number(result.p1+result.p2+result.p3+result.p4+result.p5+result.p6+result.p7+result.p8+result.p9);
						fv=Number(result.f1+result.f2+result.f3+result.f4+result.f5+result.f6+result.f7+result.f8+result.f9);
						profit=fv-pmnt;
						resultArray.push(profit);
						resultArray.splice(0, 1);
						result = profit;
					}else{
						result = resultArray[0];
					};

		      data.push({
		        date: newDate,
		        value: result
		      });

		    }
		  return data;
		}

		function generateHourlyData() {
			var firstDate = new Date('2020-07-30');
			var today = new Date();
			today.setHours(9,0,0,0);

			var dayPeriod = (today-firstDate)/1000/60/60/24+1;

			firstDate.setDate(firstDate.getDate());
			var data = [];
			var resultArray = new Array;
				resultArray = [1];//dummydata


			for(var i = 0; i < dayPeriod; i++) {
				var newDate = new Date(firstDate);
				newDate.setDate(newDate.getDate() + i);
				var dateFormat = getFormatDate(newDate);
				var result = dataset.find(dateIndex => dateIndex.date === dateFormat);

				//
				if(result && true){
					pmnt=Number(result.p1+result.p2+result.p3+result.p4+result.p5+result.p6+result.p7+result.p8+result.p9);
					fv=Number(result.f1+result.f2+result.f3+result.f4+result.f5+result.f6+result.f7+result.f8+result.f9);
					rate=(fv-pmnt)/pmnt*100;
					resultArray.push(rate.toFixed(1));
					resultArray.splice(0, 1);
					result = rate.toFixed(1);
				}else{
					result = resultArray[0];
				};

				data.push({
					date: newDate,
					value: result
				});

			}
		return data;
		}

		function assetData() {
			var firstDate = new Date('2020-07-30');
			var today = new Date();
			var todayReset = getFormatDate(today);
			document.getElementById("today").innerHTML=todayReset;
			//document.getElementById("today2").innerHTML=todayReset;
			today.setHours(9,0,0,0);

			var dayPeriod = (today-firstDate)/1000/60/60/24+1;

			firstDate.setDate(firstDate.getDate());

			var indiAsset = new Array;
				indiAsset = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];//dummydata

			for(var i = 0; i < dayPeriod; i++) {
				var newDate = new Date(firstDate);
				newDate.setDate(newDate.getDate() + i);
				var dateFormat = getFormatDate(newDate);
				var result = dataset.find(dateIndex => dateIndex.date === dateFormat);



				//
				if(result && true){
					pmnt=Number(result.p1+result.p2+result.p3+result.p4+result.p5+result.p6+result.p7+result.p8+result.p9);
					fv=Number(result.f1+result.f2+result.f3+result.f4+result.f5+result.f6+result.f7+result.f8+result.f9);
					profit=fv-pmnt;
					rate=(fv-pmnt)/pmnt*100;
					indiAsset.push(dateFormat);
					indiAsset.push(Number(result.p1));
					indiAsset.push(Number(result.p2));
					indiAsset.push(Number(result.p3));
					indiAsset.push(Number(result.p4));
					indiAsset.push(Number(result.p5));
					indiAsset.push(Number(result.p6));
					indiAsset.push(Number(result.p7));
					indiAsset.push(Number(result.p8));
					indiAsset.push(Number(result.p9));
					indiAsset.push(Number(result.f1));
					indiAsset.push(Number(result.f2));
					indiAsset.push(Number(result.f3));
					indiAsset.push(Number(result.f4));
					indiAsset.push(Number(result.f5));
					indiAsset.push(Number(result.f6));
					indiAsset.push(Number(result.f7));
					indiAsset.push(Number(result.f8));
					indiAsset.push(Number(result.f9));
					indiAsset.push(pmnt);
					indiAsset.push(fv);
					indiAsset.push(profit);
					indiAsset.push(rate.toFixed(1));
					indiAsset.splice(0, 23);
					result = indiAsset;
				}else{
					result = indiAsset;
				};

			}
		return indiAsset;
		}

		var assetTotal = assetData();
		console.log(assetTotal);
		document.getElementById("p1").innerHTML=assetTotal[1].toLocaleString();
		document.getElementById("p2").innerHTML=assetTotal[2].toLocaleString();
		document.getElementById("p3").innerHTML=assetTotal[3].toLocaleString();
		document.getElementById("p4").innerHTML=assetTotal[4].toLocaleString();
		document.getElementById("p5").innerHTML=assetTotal[5].toLocaleString();
		document.getElementById("p6").innerHTML=assetTotal[6].toLocaleString();
		document.getElementById("f1").innerHTML=assetTotal[10].toLocaleString();
		document.getElementById("f2").innerHTML=assetTotal[11].toLocaleString();
		document.getElementById("f3").innerHTML=assetTotal[12].toLocaleString();
		document.getElementById("f4").innerHTML=assetTotal[13].toLocaleString();
		document.getElementById("f5").innerHTML=assetTotal[14].toLocaleString();
		document.getElementById("f6").innerHTML=assetTotal[15].toLocaleString();
		document.getElementById("pmnt").innerHTML=assetTotal[19].toLocaleString();
		document.getElementById("fv").innerHTML=assetTotal[20].toLocaleString();
		document.getElementById("b1").innerHTML=(assetTotal[10]-assetTotal[1]).toLocaleString();
		document.getElementById("b2").innerHTML=(assetTotal[11]-assetTotal[2]).toLocaleString();
		document.getElementById("b3").innerHTML=(assetTotal[12]-assetTotal[3]).toLocaleString();
		document.getElementById("b4").innerHTML=(assetTotal[13]-assetTotal[4]).toLocaleString();
		document.getElementById("b5").innerHTML=(assetTotal[14]-assetTotal[5]).toLocaleString();
		document.getElementById("b6").innerHTML=(assetTotal[15]-assetTotal[6]).toLocaleString();
		document.getElementById("profit").innerHTML=(assetTotal[20]-assetTotal[19]).toLocaleString();
		//document.getElementById("d1").innerHTML=(assetTotal[10]/assetTotal[20]*100).toFixed(0)+"%";
		//document.getElementById("d2").innerHTML=(assetTotal[11]/assetTotal[20]*100).toFixed(0)+"%";
		//document.getElementById("d3").innerHTML=(assetTotal[12]/assetTotal[20]*100).toFixed(0)+"%";
		//document.getElementById("d4").innerHTML=(assetTotal[13]/assetTotal[20]*100).toFixed(0)+"%";
		//document.getElementById("d5").innerHTML=(assetTotal[14]/assetTotal[20]*100).toFixed(0)+"%";
		//document.getElementById("d6").innerHTML=(assetTotal[15]/assetTotal[20]*100).toFixed(0)+"%";
		//document.getElementById("pie").innerHTML="100%";
		document.getElementById("r1").innerHTML=((assetTotal[10]-assetTotal[1])/assetTotal[1]*100).toFixed(1)+"%";
		document.getElementById("r2").innerHTML=((assetTotal[11]-assetTotal[2])/assetTotal[2]*100).toFixed(1)+"%";
		document.getElementById("r3").innerHTML=((assetTotal[12]-assetTotal[3])/assetTotal[3]*100).toFixed(1)+"%";
		document.getElementById("r4").innerHTML="-"//((assetTotal[13]-assetTotal[4])/assetTotal[4]*100).toFixed(1);
		document.getElementById("r5").innerHTML=((assetTotal[14]-assetTotal[5])/assetTotal[5]*100).toFixed(1)+"%";
		document.getElementById("r6").innerHTML=((assetTotal[15]-assetTotal[6])/assetTotal[6]*100).toFixed(1)+"%";
		document.getElementById("rate").innerHTML=((assetTotal[20]-assetTotal[19])/assetTotal[19]*100).toFixed(1)+"%";

		var scrollbarX = new am4core.Scrollbar();
		scrollbarX.marginBottom = 20;
		chart.scrollbarX = scrollbarX;



		var chart = am4core.create("chartdiv_semicircle", am4charts.PieChart);
		chart.hiddenState.properties.opacity = 0; // this creates initial fade-in

		chart.data = [
			{
				asset: "한국주식(삼성증)",
				value: assetTotal[10].toLocaleString()
			},
			{
				asset: "KOSPI Index Fund",
				value: assetTotal[11].toLocaleString()
			},
			{
				asset: "미국주식(KB증, 메인)",
				value: assetTotal[12].toLocaleString()
			},
			{
				asset: "미국주식(KB증, 배당투자)",
				value: assetTotal[13].toLocaleString()
			},
			{
				asset: "미국주식(신한금투, 서브)",
				value: assetTotal[14].toLocaleString()
			},
			{
				asset: "AIM 자산관리",
				value: assetTotal[15].toLocaleString()
			}
		];
		chart.radius = am4core.percent(60);
		chart.innerRadius = am4core.percent(35);
		chart.startAngle = 180;
		chart.endAngle = 360;

		var series = chart.series.push(new am4charts.PieSeries());
		series.dataFields.value = "value";
		series.dataFields.category = "asset";

		series.slices.template.cornerRadius = 7;
		series.slices.template.innerCornerRadius = 5;
		series.slices.template.draggable = true;
		series.slices.template.inert = true;
		series.alignLabels = false;

		series.hiddenState.properties.startAngle = 90;
		series.hiddenState.properties.endAngle = 90;

		chart.legend = new am4charts.Legend();
		}); // end am4core.ready()
    </script>

	</body>
</html>
